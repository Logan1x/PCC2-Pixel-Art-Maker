let Down;

$("input[type = 'submit']").click(function(e){
  e.preventDefault();
  makeGrid();
})


function makeGrid() {
  let h=$("#inputHeight").val();
  let w=$("#inputWeight").val();
  let table=$("#pixelCanvas");

  table.children().remove();

  if(h>100) {
    h=100
    }
  if(w>100) {
    w=100
    }

    for (let i = 0; i < h; i++) {
      table.last().append("<tr> </tr>");
      for (let j = 0; j < w; j++) {
        table.children().last().append("<td></td>");
      }
    }
};

// Select color input for Custom Input
let colorPicked = $('#colorPicker').val();
$('#colorPicker').on('change', function() {
  colorPicked = $('#colorPicker').val();
});
$('.predefined-colors').on('click', function(evt) {
  colorPicked = $(evt.target).css("background-color");
  $('#colorPicker').val(rgbToHex(searchRGB()[0], searchRGB()[1], searchRGB()[2]));
});


$(document).mousedown(function () {
    Down = true;
})
$(document).mouseup(function () {
    Down = false;
});

//Selecting color for Custom colors
$( 'table' ).on( 'click', 'td' , function() {
    let colour = $('#colorPicker').val();
    $(this).css( 'background', colour );
});

$('table').on('mouseover', 'td', function () {
    if (Down) {
      let colour = $('#colorPicker').val();
        $(this).css( 'background', colour );
    }
});

$('table').on('dblclick', 'td', function(){
    $(this).css("background-color", "");
});

 function resetTable(){
   $('#pixelCanvas').empty();
 }

function resetColour(){
  $('td').css({"background-color": ""});
}



// Defining function for rgb() to hex color conversion
function searchRGB() {
  let i = colorPicked;
  let rgbValues = i.split("(")[1].split(")")[0].split(", ");
  return rgbValues;
}

function componentToHex(c) {
  var hex = Number(c).toString(16);
  return hex.length == 1 ? "0" + hex : hex;
}

function rgbToHex(r, g, b) {
  return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
}


// Extra: Sound effects
function PlaySound(soundobj) {
  var thissound = document.getElementById(soundobj);
  thissound.play();
}

function StopSound(soundobj) {
  var thissound = document.getElementById(soundobj);
  thissound.pause();
  thissound.currentTime = 0;
}

// Toggle music button
function toggleMusic() {
  var audioElem = document.getElementById("rancorEgg");
  if (audioElem.paused) audioElem.play();
  else audioElem.pause();
}


//Input Restriction
//Input height & width of the Table Restriction
function maxLengthCheck(object) {
    if (object.value.length > object.maxLength)
      object.value = object.value.slice(0, object.maxLength)
      if(object.value>50) {
      object.value =50;
      }
  }

  function isNumeric (evt) {
    var theEvent = evt || window.event;
    var key = theEvent.keyCode || theEvent.which;
    key = String.fromCharCode (key);
    var regex = /[0-9]|\./;
    if ( !regex.test(key) ) {
      theEvent.returnValue = false;
      if(theEvent.preventDefault) theEvent.preventDefault();
    }
  }


  function download() {
  	var pixelBox = $('#canvas');

  		html2canvas(pixelBox, {
  			onrendered : (canvas) => {
  				var dataURL = canvas.toDataURL('image/png');
  				var button = document.getElementById('download');
  				button.href = dataURL;
  			}
  		});
  	}

  document.getElementById('download').addEventListener('click', download);
